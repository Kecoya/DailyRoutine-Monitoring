<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç›‘æ§ä¸ä½œæ¯åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .status-bar {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            animation: pulse 2s infinite;
        }

        .status-dot.active {
            background: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .tabs {
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 30px;
            background: #f8f9fa;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .unit {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .chart-container {
            margin: 30px 0;
            text-align: center;
        }

        .chart-container img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .date-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .date-selector input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }

        .btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
        }

        .report-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .report-summary h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .summary-item .label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .summary-item .value {
            color: #333;
            font-size: 1.5em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ç³»ç»Ÿç›‘æ§ä¸ä½œæ¯åˆ†æ</h1>
            <p class="subtitle">å®æ—¶ç›‘æ§ä½ çš„å·¥ä½œçŠ¶æ€ï¼Œç§‘å­¦åˆ†æä½œæ¯è§„å¾‹</p>
        </header>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">ç›‘æ§æœåŠ¡çŠ¶æ€ï¼šæ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span id="activityInfo">æ­£åœ¨åŠ è½½æ•°æ®...</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('today')">ğŸ“… ä»Šæ—¥æ¦‚è§ˆ</button>
            <button class="tab" onclick="switchTab('week')">ğŸ“Š æœ¬å‘¨æŠ¥è¡¨</button>
            <button class="tab" onclick="switchTab('month')">ğŸ“ˆ æœ¬æœˆæŠ¥è¡¨</button>
            <button class="tab" onclick="switchTab('custom')">ğŸ” è‡ªå®šä¹‰åˆ†æ</button>
            <button class="tab" onclick="switchTab('export')">ğŸ’¾ æ•°æ®å¯¼å‡º</button>
        </div>

        <div id="today" class="content active">
            <h2>ä»Šæ—¥æ•°æ®æ¦‚è§ˆ</h2>
            <div id="todayStats" class="stats-grid"></div>
            <div class="chart-container">
                <h3>ä»Šæ—¥å¿™ç¢Œåº¦æ›²çº¿</h3>
                <div id="todayChart"></div>
            </div>
        </div>

        <div id="week" class="content">
            <h2>æœ¬å‘¨ç»Ÿè®¡æŠ¥è¡¨</h2>
            <div id="weekReport"></div>
            <div class="chart-container">
                <h3>æœ¬å‘¨è¶‹åŠ¿å›¾</h3>
                <div id="weekChart"></div>
            </div>
        </div>

        <div id="month" class="content">
            <h2>æœ¬æœˆç»Ÿè®¡æŠ¥è¡¨</h2>
            <div id="monthReport"></div>
            <div class="chart-container">
                <h3>æœ¬æœˆçƒ­åŠ›å›¾</h3>
                <div id="monthChart"></div>
            </div>
        </div>

        <div id="custom" class="content">
            <h2>è‡ªå®šä¹‰æ—¶é—´æ®µåˆ†æ</h2>
            <div class="date-selector">
                <label>å¼€å§‹æ—¥æœŸï¼š</label>
                <input type="date" id="customStart">
                <label>ç»“æŸæ—¥æœŸï¼š</label>
                <input type="date" id="customEnd">
                <button class="btn" onclick="loadCustomReport()">æŸ¥è¯¢</button>
            </div>
            <div id="customReport"></div>
            <div class="chart-container">
                <h3>è¶‹åŠ¿åˆ†æ</h3>
                <div id="customChart"></div>
            </div>
        </div>

        <div id="export" class="content">
            <h2>æ•°æ®å¯¼å‡º</h2>
            <div class="date-selector">
                <label>å¼€å§‹æ—¥æœŸï¼š</label>
                <input type="date" id="exportStart">
                <label>ç»“æŸæ—¥æœŸï¼š</label>
                <input type="date" id="exportEnd">
                <button class="btn" onclick="exportCSV()">å¯¼å‡º CSV</button>
                <button class="btn btn-secondary" onclick="exportExcel()">å¯¼å‡º Excel</button>
            </div>
            <div class="report-summary">
                <h3>å¯¼å‡ºè¯´æ˜</h3>
                <p>é€‰æ‹©æ—¶é—´èŒƒå›´åï¼Œç‚¹å‡»æŒ‰é’®å³å¯å¯¼å‡ºæ•°æ®ã€‚</p>
                <p>CSVæ ¼å¼é€‚åˆè¿›ä¸€æ­¥æ•°æ®åˆ†æï¼ŒExcelæ ¼å¼åŒ…å«æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
            </div>
        </div>

        <footer>
            <p>Â© 2025 ç³»ç»Ÿç›‘æ§ä¸ä½œæ¯åˆ†æç¨‹åº | æ•°æ®ä»…å­˜å‚¨äºæœ¬åœ°ï¼Œéšç§å®‰å…¨</p>
        </footer>
    </div>

    <script>
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // åŠ è½½å¯¹åº”æ•°æ®
            if (tabName === 'today') {
                loadTodayData();
            } else if (tabName === 'week') {
                loadWeekReport();
            } else if (tabName === 'month') {
                loadMonthReport();
            }
        }

        // æ£€æŸ¥ç›‘æ§çŠ¶æ€
        async function checkStatus() {
            try {
                const response = await fetch('/api/status');
                const result = await response.json();
                
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                const activityInfo = document.getElementById('activityInfo');

                if (result.success && result.data.running) {
                    statusDot.classList.add('active');
                    statusText.textContent = 'ç›‘æ§æœåŠ¡çŠ¶æ€ï¼šè¿è¡Œä¸­';
                    activityInfo.textContent = `ä»Šæ—¥å·²ç›‘æ§ ${result.data.keyboard_presses} æ¬¡æŒ‰é”®, ${result.data.mouse_clicks} æ¬¡ç‚¹å‡»`;
                } else {
                    statusDot.classList.remove('active');
                    statusText.textContent = 'ç›‘æ§æœåŠ¡çŠ¶æ€ï¼šæœªè¿è¡Œ';
                    activityInfo.textContent = 'è¯·å¯åŠ¨ç›‘æ§æœåŠ¡';
                }
            } catch (error) {
                console.error('æ£€æŸ¥çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // åŠ è½½ä»Šæ—¥æ•°æ®
        async function loadTodayData() {
            try {
                const response = await fetch('/api/today');
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    const statsHtml = `
                        <div class="stat-card">
                            <h3>æ´»åŠ¨æ—¶é•¿</h3>
                            <div class="value">${(data.active_minutes / 60).toFixed(1)}</div>
                            <div class="unit">å°æ—¶</div>
                        </div>
                        <div class="stat-card">
                            <h3>é¼ æ ‡ç‚¹å‡»</h3>
                            <div class="value">${data.total_clicks || 0}</div>
                            <div class="unit">æ¬¡</div>
                        </div>
                        <div class="stat-card">
                            <h3>é”®ç›˜æŒ‰é”®</h3>
                            <div class="value">${data.total_presses || 0}</div>
                            <div class="unit">æ¬¡</div>
                        </div>
                        <div class="stat-card">
                            <h3>é¼ æ ‡ç§»åŠ¨</h3>
                            <div class="value">${data.total_mouse_distance ? data.total_mouse_distance.toFixed(1) : '0.0'}</div>
                            <div class="unit">ç±³</div>
                        </div>
                        <div class="stat-card">
                            <h3>å¹³å‡å¿™ç¢ŒæŒ‡æ•°</h3>
                            <div class="value">${data.avg_busy_index ? data.avg_busy_index.toFixed(1) : '0.0'}</div>
                            <div class="unit">/ 100</div>
                        </div>
                    `;
                    document.getElementById('todayStats').innerHTML = statsHtml;

                    // åŠ è½½ä»Šæ—¥æ›²çº¿å›¾
                    loadBusyCurve();
                }
            } catch (error) {
                console.error('åŠ è½½ä»Šæ—¥æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½å¿™ç¢Œåº¦æ›²çº¿å›¾
        async function loadBusyCurve(date = null) {
            try {
                const url = date ? `/api/chart/busy_curve?date=${date}` : '/api/chart/busy_curve';
                const response = await fetch(url);
                const result = await response.json();

                if (result.success) {
                    document.getElementById('todayChart').innerHTML = 
                        `<img src="${result.data.url}?t=${Date.now()}" alt="å¿™ç¢Œåº¦æ›²çº¿">`;
                } else {
                    document.getElementById('todayChart').innerHTML = 
                        '<p class="error">æš‚æ— æ•°æ®æˆ–ç”Ÿæˆå¤±è´¥</p>';
                }
            } catch (error) {
                console.error('åŠ è½½æ›²çº¿å›¾å¤±è´¥:', error);
            }
        }

        // åŠ è½½å‘¨æŠ¥
        async function loadWeekReport() {
            try {
                const response = await fetch('/api/week');
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    const reportHtml = `
                        <div class="report-summary">
                            <h3>æœ¬å‘¨ç»Ÿè®¡</h3>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <div class="label">å·¥ä½œå¤©æ•°</div>
                                    <div class="value">${data.work_days}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">æ€»æ´»åŠ¨æ—¶é•¿</div>
                                    <div class="value">${data.total_active_hours.toFixed(1)}h</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">æ—¥å‡æ´»åŠ¨æ—¶é•¿</div>
                                    <div class="value">${data.avg_daily_active_hours.toFixed(1)}h</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">é¼ æ ‡ç§»åŠ¨æ€»è·ç¦»</div>
                                    <div class="value">${data.total_mouse_distance_m ? data.total_mouse_distance_m.toFixed(1) : '0.0'}m</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡å¿™ç¢ŒæŒ‡æ•°</div>
                                    <div class="value">${data.avg_busy_index.toFixed(1)}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡å·¥ä½œå¼ºåº¦</div>
                                    <div class="value">${data.avg_work_intensity ? data.avg_work_intensity.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡ä¸“æ³¨åº¦</div>
                                    <div class="value">${data.avg_focus_score ? data.avg_focus_score.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡æ•ˆç‡æŒ‡æ•°</div>
                                    <div class="value">${data.avg_efficiency ? data.avg_efficiency.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">ä½œæ¯è§„å¾‹æ€§</div>
                                    <div class="value">${data.regularity_score.toFixed(1)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('weekReport').innerHTML = reportHtml;

                    // åŠ è½½è¶‹åŠ¿å›¾
                    loadTrendChart(data.start_date, data.end_date, 'weekChart');
                }
            } catch (error) {
                console.error('åŠ è½½å‘¨æŠ¥å¤±è´¥:', error);
            }
        }

        // åŠ è½½æœˆæŠ¥
        async function loadMonthReport() {
            try {
                const response = await fetch('/api/month');
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    const reportHtml = `
                        <div class="report-summary">
                            <h3>æœ¬æœˆç»Ÿè®¡</h3>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <div class="label">å·¥ä½œå¤©æ•°</div>
                                    <div class="value">${data.work_days}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">æ€»æ´»åŠ¨æ—¶é•¿</div>
                                    <div class="value">${data.total_active_hours.toFixed(1)}h</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">æ—¥å‡æ´»åŠ¨æ—¶é•¿</div>
                                    <div class="value">${data.avg_daily_active_hours.toFixed(1)}h</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">é¼ æ ‡ç§»åŠ¨æ€»è·ç¦»</div>
                                    <div class="value">${data.total_mouse_distance_m ? data.total_mouse_distance_m.toFixed(1) : '0.0'}m</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡å¿™ç¢ŒæŒ‡æ•°</div>
                                    <div class="value">${data.avg_busy_index.toFixed(1)}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡å·¥ä½œå¼ºåº¦</div>
                                    <div class="value">${data.avg_work_intensity ? data.avg_work_intensity.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡ä¸“æ³¨åº¦</div>
                                    <div class="value">${data.avg_focus_score ? data.avg_focus_score.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡æ•ˆç‡æŒ‡æ•°</div>
                                    <div class="value">${data.avg_efficiency ? data.avg_efficiency.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">ä½œæ¯è§„å¾‹æ€§</div>
                                    <div class="value">${data.regularity_score.toFixed(1)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('monthReport').innerHTML = reportHtml;

                    // åŠ è½½çƒ­åŠ›å›¾
                    loadHeatmap(data.start_date, data.end_date);
                }
            } catch (error) {
                console.error('åŠ è½½æœˆæŠ¥å¤±è´¥:', error);
            }
        }

        // åŠ è½½è¶‹åŠ¿å›¾
        async function loadTrendChart(startDate, endDate, targetId) {
            try {
                const url = `/api/chart/trend?start=${startDate}&end=${endDate}`;
                const response = await fetch(url);
                const result = await response.json();

                if (result.success) {
                    document.getElementById(targetId).innerHTML = 
                        `<img src="${result.data.url}?t=${Date.now()}" alt="è¶‹åŠ¿å›¾">`;
                } else {
                    document.getElementById(targetId).innerHTML = 
                        '<p class="error">æš‚æ— æ•°æ®æˆ–ç”Ÿæˆå¤±è´¥</p>';
                }
            } catch (error) {
                console.error('åŠ è½½è¶‹åŠ¿å›¾å¤±è´¥:', error);
            }
        }

        // åŠ è½½çƒ­åŠ›å›¾
        async function loadHeatmap(startDate, endDate) {
            try {
                const url = `/api/chart/heatmap?start=${startDate}&end=${endDate}`;
                const response = await fetch(url);
                const result = await response.json();

                if (result.success) {
                    document.getElementById('monthChart').innerHTML = 
                        `<img src="${result.data.url}?t=${Date.now()}" alt="çƒ­åŠ›å›¾">`;
                } else {
                    document.getElementById('monthChart').innerHTML = 
                        '<p class="error">æš‚æ— æ•°æ®æˆ–ç”Ÿæˆå¤±è´¥</p>';
                }
            } catch (error) {
                console.error('åŠ è½½çƒ­åŠ›å›¾å¤±è´¥:', error);
            }
        }

        // åŠ è½½è‡ªå®šä¹‰æŠ¥è¡¨
        async function loadCustomReport() {
            const startDate = document.getElementById('customStart').value;
            const endDate = document.getElementById('customEnd').value;

            if (!startDate || !endDate) {
                alert('è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ');
                return;
            }

            try {
                const response = await fetch(`/api/custom?start=${startDate}&end=${endDate}`);
                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    const reportHtml = `
                        <div class="report-summary">
                            <h3>ç»Ÿè®¡ç»“æœ (${startDate} è‡³ ${endDate})</h3>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <div class="label">å·¥ä½œå¤©æ•°</div>
                                    <div class="value">${data.work_days}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">æ€»æ´»åŠ¨æ—¶é•¿</div>
                                    <div class="value">${data.total_active_hours.toFixed(1)}h</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">æ—¥å‡æ´»åŠ¨æ—¶é•¿</div>
                                    <div class="value">${data.avg_daily_active_hours.toFixed(1)}h</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">é¼ æ ‡ç§»åŠ¨æ€»è·ç¦»</div>
                                    <div class="value">${data.total_mouse_distance_m ? data.total_mouse_distance_m.toFixed(1) : '0.0'}m</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡å¿™ç¢ŒæŒ‡æ•°</div>
                                    <div class="value">${data.avg_busy_index.toFixed(1)}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡å·¥ä½œå¼ºåº¦</div>
                                    <div class="value">${data.avg_work_intensity ? data.avg_work_intensity.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡ä¸“æ³¨åº¦</div>
                                    <div class="value">${data.avg_focus_score ? data.avg_focus_score.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">å¹³å‡æ•ˆç‡æŒ‡æ•°</div>
                                    <div class="value">${data.avg_efficiency ? data.avg_efficiency.toFixed(1) : '0.0'}</div>
                                </div>
                                <div class="summary-item">
                                    <div class="label">ä½œæ¯è§„å¾‹æ€§</div>
                                    <div class="value">${data.regularity_score.toFixed(1)}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('customReport').innerHTML = reportHtml;

                    // åŠ è½½è¶‹åŠ¿å›¾
                    loadTrendChart(startDate, endDate, 'customChart');
                }
            } catch (error) {
                console.error('åŠ è½½è‡ªå®šä¹‰æŠ¥è¡¨å¤±è´¥:', error);
            }
        }

        // å¯¼å‡ºCSV
        function exportCSV() {
            const startDate = document.getElementById('exportStart').value;
            const endDate = document.getElementById('exportEnd').value;

            if (!startDate || !endDate) {
                alert('è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ');
                return;
            }

            window.location.href = `/api/export/csv?start=${startDate}&end=${endDate}`;
        }

        // å¯¼å‡ºExcel
        function exportExcel() {
            const startDate = document.getElementById('exportStart').value;
            const endDate = document.getElementById('exportEnd').value;

            if (!startDate || !endDate) {
                alert('è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ');
                return;
            }

            window.location.href = `/api/export/excel?start=${startDate}&end=${endDate}`;
        }

        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        function initDateSelectors() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

            document.getElementById('customStart').value = weekAgo;
            document.getElementById('customEnd').value = today;
            document.getElementById('exportStart').value = weekAgo;
            document.getElementById('exportEnd').value = today;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            checkStatus();
            loadTodayData();
            initDateSelectors();

            // å®šæœŸæ£€æŸ¥çŠ¶æ€
            setInterval(checkStatus, 10000);
        };
    </script>
</body>
</html>

